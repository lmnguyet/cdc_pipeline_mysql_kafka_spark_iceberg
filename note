DOCKER COMPOSE
docker network create my-network
1. mysql 8.0
- tạo user chính dùng trong project: lminhnguyet - 123
- tạo các db cần dùng
+ pixar_films : source db
+ metastore: dùng cho hive catalog/iceberg tables
+ airflow: dùng cho airflow
- gán quyền của các db trên cho user chính
** thứ tự 1
** port 3306

2. zookeeper 3.9
** thứ tự 1

3. kafka 3.9
** thứ tự 2, depend zookeeper
** port 9092

4. kafka-ui
** thứ tự 3, depend kafka
** port 9089

5. minio
** thứ tự 1
** port 9001

6. connector
- chứa debezium match với kafka 3.9
- chứa kafka-connect-s3 10.6.3
- tạo 2 connector từ mysql đến kafka và từ kafka đến minio
** thứ tự 3, depend minio, kafka, mysql

7. hive-metastore
- kết nối đến mysql và minio, tạo metastore cho iceberg tables
** thứ tự 2, depend mysql, minio

8. spark-master (spark 3.5 python 3.12)
** thứ tự 3, depend minio, hive-metastore
** port 8080
docker build -t spark-img ./spark
docker volume create spark_home_data

9. spark-worker
** thứ tự 4, depend spark-master

10. airflow (airflow 2.9.3 jdk 17 python 3.12 airflow minio)
** thứ tự 5
** port 18080
docker build -t airflow-img:2.9 ./airflow
export AIRFLOW_UID=$(id -u)
docker compose -f docker-compose.airflow.yml up -d airflow-init
create spark-conn connect to spark-master on airflow-webserver:
- host: spark://spark-master
- port: 7077
- deploy mode: client
mount spark_home_data from spark-master to airflow & add $SPARK_HOME to PATH

11. superset
** port 8088
docker build -t superset-img ./superset
create database connect to trino: trino://trino:@trino:8080/iceberg
create dataset query from database

12. fastapi
** port 8000
docker build -t fastapi-img ./fastapi

curl -X POST "http://localhost:8000/query" \
-H "Content-Type: application/json" \
-d '{
    "sql": <Your SQL query>
}' | jq

=== relist ports of containers

13. data architecture/data flow
- mysql > kafka
- kafka > daily data
- daily data > bronze
- bronze > silver (multi-dimensional model/star schema)

14. optimization
